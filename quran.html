<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0c1a12">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Amiri:ital,wght@0,400;0,700&family=Noto+Naskh+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â• TOKENS â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:#080f0a; --bg2:#0c1710; --surf:#111d14; --surf2:#172218; --surf3:#1e2e20;
  --bdr:rgba(196,160,60,.18); --bdr-h:rgba(196,160,60,.45);
  --gold:#c4a03c; --gold-l:#e0bc5a; --gold-d:#8a6e26; --glow:rgba(196,160,60,.2);
  --grn:#2a5c38; --grn-l:#3d7a50;
  --tx:#f0e8d8; --tx2:#b8a890; --tx3:#7a6e5e;
  --ease:cubic-bezier(.4,0,.2,1);
  --sw:300px; /* sidebar width */
}
body.light {
  --bg:#f0e8d5; --bg2:#e8dfc8; --surf:#fdf6e3; --surf2:#f5ecd5; --surf3:#ede3cc;
  --bdr:rgba(120,90,20,.15); --bdr-h:rgba(120,90,20,.4);
  --gold:#7a5a10; --gold-l:#9a7218; --gold-d:#c8a84a; --glow:rgba(122,90,16,.15);
  --tx:#1a1005; --tx2:#5a4820; --tx3:#8a7a5a;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;}
html{scroll-behavior:smooth;}
body{
  font-family:'Noto Naskh Arabic',serif;
  background:var(--bg);color:var(--tx);
  min-height:100vh;overflow-x:hidden;
  transition:background .4s,color .4s;
}
body::before{
  content:'';position:fixed;inset:0;
  background-image:
    repeating-linear-gradient(60deg,transparent,transparent 38px,rgba(196,160,60,.018) 38px,rgba(196,160,60,.018) 39px),
    repeating-linear-gradient(-60deg,transparent,transparent 38px,rgba(196,160,60,.018) 38px,rgba(196,160,60,.018) 39px);
  pointer-events:none;z-index:0;
}

/* â•â•â•â•â•â•â•â•â•â• LAYOUT â•â•â•â•â•â•â•â•â•â• */
.app{display:flex;min-height:100vh;position:relative;z-index:1;}

/* â”€ SIDEBAR â”€ */
.sidebar{
  width:var(--sw);flex-shrink:0;
  background:var(--surf);border-left:1px solid var(--bdr);
  display:flex;flex-direction:column;
  height:100vh;position:sticky;top:0;
  transition:transform .35s var(--ease);
  z-index:200;overflow:hidden;
}
.sb-head{padding:18px 16px 14px;border-bottom:1px solid var(--bdr);flex-shrink:0;}
.sb-logo{display:flex;align-items:center;gap:10px;text-decoration:none;margin-bottom:12px;}
.sb-mark{
  width:34px;height:34px;border-radius:9px;
  background:linear-gradient(135deg,var(--gold),var(--gold-l));
  display:flex;align-items:center;justify-content:center;font-size:1.1rem;
  box-shadow:0 3px 10px var(--glow);flex-shrink:0;
}
.sb-txt{font-family:'Amiri',serif;font-size:.97rem;color:var(--gold-l);font-weight:700;}
.sb-search{position:relative;}
.sb-search input{
  width:100%;background:var(--surf2);border:1px solid var(--bdr);border-radius:9px;
  padding:8px 36px 8px 12px;color:var(--tx);
  font-family:'Noto Naskh Arabic',serif;font-size:.85rem;
}
.sb-search input:focus{outline:none;border-color:var(--bdr-h);}
.sb-search input::placeholder{color:var(--tx3);}
.sb-si{position:absolute;left:11px;top:50%;transform:translateY(-50%);color:var(--tx3);font-size:.8rem;}
.surah-list{flex:1;overflow-y:auto;padding:6px;}
.surah-list::-webkit-scrollbar{width:3px;}
.surah-list::-webkit-scrollbar-thumb{background:var(--gold-d);border-radius:2px;}
.si{
  display:flex;align-items:center;gap:9px;padding:9px 10px;
  border-radius:9px;cursor:pointer;transition:all .18s;border:1px solid transparent;
}
.si:hover{background:var(--surf2);border-color:var(--bdr);}
.si.active{background:rgba(196,160,60,.1);border-color:var(--bdr-h);}
.si.active .si-name{color:var(--gold-l);}
.si-num{
  width:28px;height:28px;border-radius:7px;background:var(--surf2);
  display:flex;align-items:center;justify-content:center;
  font-size:.72rem;color:var(--tx3);flex-shrink:0;font-family:'Amiri',serif;
}
.si.active .si-num{background:rgba(196,160,60,.15);color:var(--gold);}
.si-inf{flex:1;min-width:0;}
.si-name{font-family:'Amiri',serif;font-size:.97rem;color:var(--tx);display:block;line-height:1.2;}
.si-meta{font-size:.68rem;color:var(--tx3);}
.si-rev{font-size:.62rem;padding:2px 6px;border-radius:5px;background:var(--surf3);color:var(--tx3);flex-shrink:0;}

/* â”€ MAIN â”€ */
.main{flex:1;display:flex;flex-direction:column;min-width:0;}

/* â”€ TOPBAR â”€ */
.topbar{
  position:sticky;top:0;z-index:100;padding:0 22px;
  transition:all .3s;border-bottom:1px solid transparent;
}
.topbar.scrolled{
  background:rgba(8,15,10,.93);border-bottom-color:var(--bdr);
  backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);
}
body.light .topbar.scrolled{background:rgba(240,232,213,.93);}
.tb-inner{
  max-width:820px;margin:0 auto;
  display:flex;align-items:center;justify-content:space-between;
  padding:13px 0;gap:14px;
}
.back-btn{
  display:inline-flex;align-items:center;gap:6px;
  color:var(--tx2);font-size:.85rem;text-decoration:none;
  padding:7px 14px;border:1px solid var(--bdr);border-radius:28px;transition:all .2s;flex-shrink:0;
}
.back-btn:hover{border-color:var(--bdr-h);color:var(--gold-l);}
.tb-title{font-family:'Amiri',serif;font-size:1.05rem;color:var(--gold-l);text-align:center;flex:1;}
.tb-acts{display:flex;gap:7px;align-items:center;}
.tbtn{
  width:35px;height:35px;border-radius:50%;border:1px solid var(--bdr);background:var(--surf);
  color:var(--tx2);font-size:.88rem;cursor:pointer;
  display:flex;align-items:center;justify-content:center;transition:all .2s;
}
.tbtn:hover{border-color:var(--bdr-h);color:var(--gold);}
.burger{display:none;flex-direction:column;gap:4px;cursor:pointer;padding:7px;border:none;background:none;}
.burger span{display:block;width:19px;height:2px;background:var(--tx2);border-radius:2px;transition:all .3s var(--ease);}
.burger.open span:nth-child(1){transform:translateY(6px) rotate(45deg);}
.burger.open span:nth-child(2){opacity:0;}
.burger.open span:nth-child(3){transform:translateY(-6px) rotate(-45deg);}
.mob-nav-menu{
  display:none;position:fixed;inset:0;top:66px;
  background:var(--bg);z-index:850;padding:24px 18px;
  flex-direction:column;gap:7px;border-top:1px solid var(--bdr);
}
.mob-nav-menu.open{display:flex;}
.mob-nav-menu .si{font-size:1rem;padding:12px 16px;border:1px solid var(--bdr);border-radius:11px;}

/* â•â•â•â•â•â•â•â•â•â• DESKTOP READER â•â•â•â•â•â•â•â•â•â• */
.reader{flex:1;padding:36px 22px 70px;max-width:820px;width:100%;margin:0 auto;}

/* Mobile surah bar */
.mob-surah-bar{display:none;margin-bottom:20px;}
.mob-surah-bar select{
  width:100%;background:var(--surf);border:1px solid var(--bdr);border-radius:11px;
  padding:11px 14px;color:var(--tx);font-family:'Noto Naskh Arabic',serif;font-size:.92rem;cursor:pointer;
}
.mob-surah-bar select:focus{outline:none;border-color:var(--bdr-h);}

.offline-bar{
  display:none;align-items:center;gap:9px;
  background:rgba(220,80,60,.12);border:1px solid rgba(220,80,60,.28);
  border-radius:11px;padding:11px 16px;margin-bottom:18px;font-size:.86rem;color:#ff9a8a;
}
.offline-bar.show{display:flex;}

/* Empty */
.empty-state{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:60vh;text-align:center;gap:14px;
}
.empty-icon{
  width:90px;height:90px;border-radius:50%;background:var(--surf);border:1px solid var(--bdr);
  display:flex;align-items:center;justify-content:center;font-size:2.6rem;
  box-shadow:0 8px 28px rgba(0,0,0,.3);
}
.empty-title{font-family:'Amiri',serif;font-size:1.7rem;color:var(--tx2);}
.empty-sub{font-size:.88rem;color:var(--tx3);}

/* Loader */
.loader{display:none;flex-direction:column;align-items:center;justify-content:center;min-height:50vh;gap:16px;}
.loader.show{display:flex;}
.spinner{width:46px;height:46px;border:3px solid var(--bdr);border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
.loader-txt{color:var(--tx3);font-size:.88rem;}

/* Surah card (desktop) */
.surah-card{display:none;animation:fdIn .45s var(--ease);}
.surah-card.show{display:block;}
@keyframes fdIn{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:none;}}

/* Surah header */
.sh{
  text-align:center;padding:36px 28px 32px;margin-bottom:26px;
  background:var(--surf);border:1px solid var(--bdr);border-radius:22px;
  position:relative;overflow:hidden;
}
.sh::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,var(--gold),var(--gold-l),var(--gold),transparent);}
.sh::after {content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,var(--gold),var(--gold-l),var(--gold),transparent);}
.sh-corner{position:absolute;font-size:1.3rem;opacity:.22;color:var(--gold);line-height:1;}
.sh-corner.tl{top:9px;right:12px;} .sh-corner.tr{top:9px;left:12px;}
.sh-corner.bl{bottom:9px;right:12px;} .sh-corner.br{bottom:9px;left:12px;}
.sh-num{display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;background:rgba(196,160,60,.12);border:1px solid var(--bdr-h);border-radius:50%;font-family:'Amiri',serif;font-size:1.05rem;color:var(--gold);margin-bottom:12px;}
.sh-name{font-family:'Amiri',serif;font-size:clamp(2rem,5.5vw,3.2rem);color:var(--tx);line-height:1.1;margin-bottom:5px;}
.sh-name-en{font-size:.82rem;color:var(--tx3);margin-bottom:16px;}
.sh-meta{display:inline-flex;align-items:center;gap:14px;background:var(--surf2);border:1px solid var(--bdr);border-radius:28px;padding:6px 18px;font-size:.78rem;color:var(--tx2);margin-bottom:20px;}
.sh-sep{width:1px;height:12px;background:var(--bdr);}
.bismillah{font-family:'Amiri Quran',serif;font-size:clamp(1.5rem,3.8vw,2.1rem);color:var(--gold-l);line-height:1.9;text-shadow:0 0 24px var(--glow);}

/* Controls */
.controls{
  background:var(--surf);border:1px solid var(--bdr);border-radius:14px;
  padding:14px 18px;margin-bottom:20px;
  display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;
}
.ctrl-g{display:flex;align-items:center;gap:7px;flex-wrap:wrap;}
.ctrl-lbl{font-size:.76rem;color:var(--tx3);flex-shrink:0;}
.ctrl-sel{
  background:var(--surf2);border:1px solid var(--bdr);border-radius:8px;padding:7px 11px;
  color:var(--tx);font-family:'Noto Naskh Arabic',serif;font-size:.83rem;cursor:pointer;min-width:130px;transition:all .2s;
}
.ctrl-sel:focus{outline:none;border-color:var(--bdr-h);}
.font-btns{display:flex;gap:3px;}
.font-btn{
  width:32px;height:32px;border-radius:7px;border:1px solid var(--bdr);background:var(--surf2);
  color:var(--tx2);cursor:pointer;font-weight:700;display:flex;align-items:center;justify-content:center;font-size:.88rem;transition:all .2s;
}
.font-btn:hover{border-color:var(--bdr-h);color:var(--gold);}
.save-btn{
  display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:9px;
  border:1px solid var(--bdr);background:var(--surf2);color:var(--tx2);
  font-family:'Noto Naskh Arabic',serif;font-size:.83rem;cursor:pointer;transition:all .2s;
}
.save-btn:hover{border-color:var(--bdr-h);color:var(--gold);}
.save-btn.saved{background:rgba(196,160,60,.1);border-color:var(--bdr-h);color:var(--gold-l);}

/* Audio */
.audio-wrap{
  background:var(--surf);border:1px solid var(--bdr);border-radius:14px;padding:16px 20px;
  margin-bottom:22px;display:flex;flex-wrap:wrap;align-items:center;gap:12px;
}
.audio-lbl{font-size:.78rem;color:var(--tx3);flex-shrink:0;}
audio{flex:1;min-width:180px;height:38px;border-radius:19px;filter:sepia(20%) hue-rotate(100deg);}
body.light audio{filter:sepia(10%) hue-rotate(80deg);}
.dl-btn{
  display:inline-flex;align-items:center;gap:6px;padding:8px 16px;
  background:linear-gradient(135deg,var(--gold-d),var(--gold));color:#0c1008;
  font-family:'Noto Naskh Arabic',serif;font-weight:700;font-size:.8rem;
  border-radius:9px;text-decoration:none;transition:all .2s;border:none;cursor:pointer;white-space:nowrap;
}
.dl-btn:hover{transform:translateY(-2px);box-shadow:0 5px 16px var(--glow);}

/* Tabs */
.tabs{display:flex;background:var(--surf);border:1px solid var(--bdr);border-radius:11px;overflow:hidden;margin-bottom:18px;}
.tab-btn{flex:1;padding:10px;text-align:center;font-family:'Noto Naskh Arabic',serif;font-size:.86rem;color:var(--tx2);cursor:pointer;border:none;background:transparent;transition:all .2s;border-bottom:2px solid transparent;}
.tab-btn.active{color:var(--gold-l);border-bottom-color:var(--gold);background:rgba(196,160,60,.06);}

/* Quran text (desktop) */
.quran-text{
  font-family:'Amiri Quran',serif;font-size:1.95rem;line-height:2.75;text-align:justify;
  color:var(--tx);padding:28px 24px;background:var(--surf);border:1px solid var(--bdr);border-radius:18px;
}
body.light .quran-text{background:linear-gradient(135deg,#fdf6e3,#f9f0d3);box-shadow:0 4px 28px rgba(120,80,10,.07);}
.ayah-span{display:inline;cursor:pointer;border-radius:4px;transition:background .15s;padding:1px 2px;}
.ayah-span:hover{background:rgba(196,160,60,.12);}
.ayah-num{display:inline-flex;align-items:center;justify-content:center;width:26px;height:26px;background:linear-gradient(135deg,var(--gold-d),var(--gold));color:#0c1008;border-radius:50%;font-size:.52em;font-weight:700;margin:0 5px;vertical-align:middle;font-family:'Noto Naskh Arabic',serif;flex-shrink:0;}
.page-divider{text-align:center;margin:22px 0 8px;position:relative;}
.page-divider::before{content:'';position:absolute;top:50%;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--gold),transparent);}
.pd-name{position:relative;display:inline-block;background:var(--surf);padding:3px 14px;font-family:'Amiri',serif;font-size:1.05rem;color:var(--gold-l);border:1px solid var(--bdr);border-radius:18px;}
body.light .pd-name{background:#fdf6e3;}
.page-bism{text-align:center;font-family:'Amiri Quran',serif;font-size:1.35rem;color:var(--gold-l);margin:8px 0 14px;line-height:2;}

/* Tafseer */
.tafseer-text{display:none;background:var(--surf);border:1px solid var(--bdr);border-radius:18px;padding:24px;}
.tafseer-text.show{display:block;animation:fdIn .4s;}
.ta{padding:16px 0;border-bottom:1px solid var(--bdr);}
.ta:last-child{border-bottom:none;}
.ta-ar{font-family:'Amiri Quran',serif;font-size:1.45rem;line-height:2.1;color:var(--tx);margin-bottom:10px;padding:14px;background:var(--surf2);border-radius:11px;border-right:3px solid var(--gold);}
.ta-tf{font-size:.9rem;color:var(--tx2);line-height:1.9;}
.ta-n{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;background:rgba(196,160,60,.14);border:1px solid var(--bdr-h);border-radius:50%;font-size:.67rem;color:var(--gold);font-family:'Noto Naskh Arabic',serif;float:right;margin-left:8px;}

/* Saved */
.saved-wrap{margin-top:28px;background:var(--surf);border:1px solid var(--bdr);border-radius:14px;padding:18px;display:none;}
.saved-wrap.show{display:block;animation:fdIn .4s;}
.saved-head{font-family:'Amiri',serif;font-size:1.05rem;color:var(--gold-l);margin-bottom:12px;display:flex;align-items:center;gap:7px;}
.saved-pills{display:flex;flex-wrap:wrap;gap:7px;}
.saved-pill{padding:6px 14px;border-radius:18px;border:1px solid var(--bdr);background:var(--surf2);color:var(--tx2);font-size:.83rem;cursor:pointer;transition:all .2s;}
.saved-pill:hover{border-color:var(--gold);color:var(--gold-l);}

/* Toast */
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(70px);background:var(--surf3);border:1px solid var(--bdr-h);color:var(--gold-l);padding:11px 22px;border-radius:28px;font-size:.88rem;font-weight:600;z-index:9999;transition:transform .3s var(--ease);box-shadow:0 8px 22px rgba(0,0,0,.4);white-space:nowrap;}
.toast.show{transform:translateX(-50%) translateY(0);}

/* Overlay */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:150;backdrop-filter:blur(4px);}
.overlay.show{display:block;}

/* Scrollbar */
::-webkit-scrollbar{width:5px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--gold-d);border-radius:3px;}
::selection{background:rgba(196,160,60,.25);color:var(--gold-l);}

/* â•â•â•â•â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â•â•â•â•â• */
@media(max-width:860px){
  .sidebar{position:fixed;top:0;right:0;bottom:0;transform:translateX(110%);z-index:200;}
  .sidebar.open{transform:translateX(0);}
  .burger{display:flex;}
  .mob-surah-bar{display:block;}
  .reader{padding:20px 14px 0;}

  /* hide desktop reader on mobile â€” mobile uses flip mode */
  .surah-card,.empty-state,.loader,.saved-wrap,.offline-bar{display:none!important;}
}
@media(min-width:861px){
  /* hide mobile flip UI on desktop */
  #mobileReader{display:none!important;}
}

/* â•â•â•â•â•â•â•â•â•â• MOBILE FLIP READER â•â•â•â•â•â•â•â•â•â• */
#mobileReader{
  display:none; /* shown only on mobile via media */
  position:fixed;inset:0;
  background:var(--bg);
  z-index:500;
  flex-direction:column;
  overflow:hidden;
}
@media(max-width:860px){
  #mobileReader{display:flex;}
  body{overflow:hidden;} /* prevent body scroll on mobile */
}

/* Mobile topbar */
.mob-topbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 16px;
  background:var(--surf);border-bottom:1px solid var(--bdr);
  flex-shrink:0;z-index:10;
  gap:8px;
}
.mob-back{
  display:inline-flex;align-items:center;gap:5px;
  color:var(--tx2);font-size:.82rem;text-decoration:none;
  padding:6px 12px;border:1px solid var(--bdr);border-radius:24px;transition:all .2s;flex-shrink:0;
}
.mob-back:hover{border-color:var(--bdr-h);color:var(--gold-l);}
.mob-title{font-family:'Amiri',serif;font-size:.95rem;color:var(--gold-l);text-align:center;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.mob-acts{display:flex;gap:6px;}
.mob-btn{width:32px;height:32px;border-radius:50%;border:1px solid var(--bdr);background:var(--surf2);color:var(--tx2);font-size:.82rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;}
.mob-btn:hover{border-color:var(--bdr-h);color:var(--gold);}

/* Surah picker bar */
.mob-surah-picker{
  padding:8px 12px;background:var(--surf2);border-bottom:1px solid var(--bdr);flex-shrink:0;
}
.mob-surah-picker select{
  width:100%;background:var(--surf);border:1px solid var(--bdr);border-radius:9px;
  padding:8px 12px;color:var(--tx);font-family:'Noto Naskh Arabic',serif;font-size:.88rem;cursor:pointer;
}
.mob-surah-picker select:focus{outline:none;border-color:var(--bdr-h);}

/* Page flip container */
.flip-wrap{
  flex:1;position:relative;overflow:hidden;
  touch-action:pan-y; /* allow vertical scroll inside page but catch horizontal */
}

/* Page â€” the unit that gets swiped */
.flip-page{
  position:absolute;inset:0;
  overflow-y:auto;
  padding:16px 14px 20px;
  transition:transform .32s var(--ease),opacity .32s var(--ease);
  will-change:transform,opacity;
  -webkit-overflow-scrolling:touch;
}
.flip-page::-webkit-scrollbar{display:none;}

/* Slide states */
.flip-page.slide-out-left {transform:translateX(-100%);opacity:0;pointer-events:none;}
.flip-page.slide-out-right{transform:translateX(100%); opacity:0;pointer-events:none;}
.flip-page.slide-in-left  {animation:sileft .32s var(--ease);}
.flip-page.slide-in-right {animation:siright .32s var(--ease);}
@keyframes sileft {from{transform:translateX(-100%);opacity:0;}to{transform:none;opacity:1;}}
@keyframes siright{from{transform:translateX(100%); opacity:0;}to{transform:none;opacity:1;}}

/* Page header (mobile) */
.fp-header{
  text-align:center;padding:20px 12px 18px;margin-bottom:14px;
  background:var(--surf);border:1px solid var(--bdr);border-radius:16px;
  position:relative;overflow:hidden;
}
.fp-header::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);}
.fp-header::after {content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);}
.fp-surah-name{font-family:'Amiri',serif;font-size:1.8rem;color:var(--tx);line-height:1.1;margin-bottom:4px;}
.fp-meta{font-size:.72rem;color:var(--tx3);margin-bottom:12px;}
.fp-bism{font-family:'Amiri Quran',serif;font-size:1.2rem;color:var(--gold-l);line-height:2;}

/* Audio (mobile) */
.fp-audio{
  display:flex;align-items:center;gap:8px;flex-wrap:wrap;
  background:var(--surf);border:1px solid var(--bdr);border-radius:12px;
  padding:10px 14px;margin-bottom:14px;
}
.fp-audio-lbl{font-size:.72rem;color:var(--tx3);flex-shrink:0;}
.fp-audio audio{flex:1;min-width:120px;height:34px;border-radius:17px;filter:sepia(20%) hue-rotate(100deg);}
body.light .fp-audio audio{filter:sepia(10%) hue-rotate(80deg);}
.fp-reciter{
  width:100%;background:var(--surf2);border:1px solid var(--bdr);border-radius:7px;
  padding:6px 10px;color:var(--tx);font-family:'Noto Naskh Arabic',serif;font-size:.8rem;cursor:pointer;
}

/* Quran text (mobile) */
.fp-text{
  font-family:'Amiri Quran',serif;font-size:1.75rem;line-height:2.8;text-align:justify;
  color:var(--tx);padding:18px 14px;background:var(--surf);border:1px solid var(--bdr);border-radius:16px;
  word-spacing:2px;
}
body.light .fp-text{background:linear-gradient(135deg,#fdf6e3,#f8eed0);}
.fp-text .ayah-span{display:inline;border-radius:3px;transition:background .15s;}
.fp-text .ayah-span:active{background:rgba(196,160,60,.18);}
.fp-text .ayah-num{display:inline-flex;align-items:center;justify-content:center;width:23px;height:23px;background:linear-gradient(135deg,var(--gold-d),var(--gold));color:#0c1008;border-radius:50%;font-size:.48em;font-weight:700;margin:0 4px;vertical-align:middle;font-family:'Noto Naskh Arabic',serif;}
.fp-divider{text-align:center;margin:18px 0 6px;position:relative;}
.fp-divider::before{content:'';position:absolute;top:50%;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--gold),transparent);}
.fp-dname{position:relative;display:inline-block;background:var(--surf);padding:3px 12px;font-family:'Amiri',serif;font-size:.95rem;color:var(--gold-l);border:1px solid var(--bdr);border-radius:14px;}
body.light .fp-dname{background:#fdf6e3;}
.fp-bism-mid{text-align:center;font-family:'Amiri Quran',serif;font-size:1.15rem;color:var(--gold-l);margin:6px 0 12px;line-height:2;}

/* Mobile bottom nav bar */
.mob-nav-bar{
  display:flex;align-items:center;justify-content:space-between;
  padding:8px 12px;background:var(--surf);border-top:1px solid var(--bdr);flex-shrink:0;gap:8px;
}
.mnb-btn{
  display:flex;align-items:center;gap:5px;
  background:var(--surf2);border:1px solid var(--bdr);border-radius:9px;
  padding:8px 12px;color:var(--tx2);font-family:'Noto Naskh Arabic',serif;
  font-size:.78rem;cursor:pointer;transition:all .2s;max-width:120px;
}
.mnb-btn:hover,.mnb-btn:active{border-color:var(--bdr-h);color:var(--gold-l);}
.mnb-btn:disabled{opacity:.25;pointer-events:none;}
.mnb-btn span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;}
.mnb-center{text-align:center;font-size:.72rem;color:var(--tx3);line-height:1.4;flex:1;}
.mnb-center strong{display:block;color:var(--gold);font-size:.78rem;}

/* Mobile loader */
.mob-loader{
  display:none;position:absolute;inset:0;
  align-items:center;justify-content:center;flex-direction:column;gap:14px;
  background:var(--bg);z-index:20;
}
.mob-loader.show{display:flex;}

/* â•â• END OF SURAH POPUP â•â• */
.eos-popup{
  display:none;position:absolute;inset:0;
  align-items:center;justify-content:center;
  background:rgba(8,15,10,.88);backdrop-filter:blur(8px);z-index:30;
  padding:24px;
}
.eos-popup.show{display:flex;animation:fdIn .35s;}
.eos-card{
  background:var(--surf);border:1px solid var(--bdr-h);border-radius:22px;
  padding:32px 26px;text-align:center;max-width:320px;width:100%;
  box-shadow:0 20px 50px rgba(0,0,0,.5);
}
.eos-icon{font-size:2.8rem;margin-bottom:10px;}
.eos-title{font-family:'Amiri',serif;font-size:1.6rem;color:var(--gold-l);margin-bottom:6px;}
.eos-sub{font-size:.88rem;color:var(--tx3);margin-bottom:24px;line-height:1.7;}
.eos-btns{display:flex;flex-direction:column;gap:10px;}
.eos-btn-main{
  padding:13px;border-radius:12px;border:none;cursor:pointer;
  background:linear-gradient(135deg,var(--gold-d),var(--gold));
  color:#0c1008;font-family:'Noto Naskh Arabic',serif;font-weight:700;font-size:.95rem;
  transition:all .2s;box-shadow:0 4px 16px var(--glow);
}
.eos-btn-main:hover{transform:translateY(-2px);box-shadow:0 8px 24px var(--glow);}
.eos-btn-sec{
  padding:11px;border-radius:12px;cursor:pointer;
  background:transparent;border:1px solid var(--bdr);
  color:var(--tx2);font-family:'Noto Naskh Arabic',serif;font-size:.88rem;transition:all .2s;
}
.eos-btn-sec:hover{border-color:var(--bdr-h);color:var(--gold-l);}
.eos-btn-dismiss{background:none;border:none;color:var(--tx3);font-size:.82rem;cursor:pointer;padding:4px;font-family:'Noto Naskh Arabic',serif;}

/* Font size control (mobile) */
.fp-font-ctrl{
  display:flex;justify-content:center;gap:6px;margin-bottom:10px;
}
.fp-font-ctrl button{
  width:30px;height:30px;border-radius:7px;border:1px solid var(--bdr);background:var(--surf2);
  color:var(--tx2);font-weight:700;font-size:.85rem;cursor:pointer;transition:all .2s;
  display:flex;align-items:center;justify-content:center;
}
.fp-font-ctrl button:hover{border-color:var(--bdr-h);color:var(--gold);}
</style>
</head>
<body>

<div class="toast" id="toast"></div>
<div class="overlay" id="overlay" onclick="closeSidebar()"></div>

<!-- â•â•â•â•â•â•â•â• DESKTOP APP â•â•â•â•â•â•â•â• -->
<div class="app">

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sb-head">
      <a href="index.html" class="sb-logo"><div class="sb-mark">ğŸŒ™</div><span class="sb-txt">Ø§Ù„Ù…ÙˆØ³ÙˆØ¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</span></a>
      <div class="sb-search">
        <input type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙˆØ±Ø©..." id="searchInput" oninput="filterSurahs()">
        <span class="sb-si">ğŸ”</span>
      </div>
    </div>
    <div class="surah-list" id="surahList"></div>
  </aside>

  <!-- Main -->
  <div class="main">
    <div class="topbar" id="topbar">
      <div class="tb-inner">
        <a href="index.html" class="back-btn">â¬… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <span class="tb-title" id="topbarTitle">Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>
        <div class="tb-acts">
          <button class="tbtn" onclick="toggleTheme()">ğŸŒ“</button>
          <button class="tbtn burger" id="burgerBtn" onclick="toggleSidebar()"><span></span><span></span><span></span></button>
        </div>
      </div>
    </div>

    <div class="reader">
      <div class="mob-surah-bar"><select id="mobSurahSel" onchange="selectSurah(this.value)"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©...</option></select></div>
      <div class="offline-bar" id="offlineBar">ğŸ“´ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„ â€” Ø§Ù„Ø³ÙˆØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙ‚Ø·</div>

      <div class="empty-state" id="emptyState">
        <div class="empty-icon">ğŸ“–</div>
        <div class="empty-title">Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>
        <div class="empty-sub">Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø§Ù†Ø¨</div>
      </div>
      <div class="loader" id="loader"><div class="spinner"></div><span class="loader-txt" id="loaderTxt">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></div>

      <div class="surah-card" id="surahCard">
        <div class="sh">
          <span class="sh-corner tl">â§</span><span class="sh-corner tr">â§</span>
          <span class="sh-corner bl">â§</span><span class="sh-corner br">â§</span>
          <div class="sh-num" id="shNum">Ù¡</div>
          <h1 class="sh-name" id="shName">Ø§Ù„ÙØ§ØªØ­Ø©</h1>
          <div class="sh-name-en" id="shNameEn"></div>
          <div class="sh-meta"><span>ğŸ•Œ <span id="shRev"></span></span><div class="sh-sep"></div><span>ğŸ“¿ <span id="shAyahs"></span> Ø¢ÙŠØ©</span></div>
          <div class="bismillah" id="deskBism">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ€Ù°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
        </div>
        <div class="controls">
          <div class="ctrl-g"><span class="ctrl-lbl">Ø§Ù„Ù‚Ø§Ø±Ø¦:</span>
            <select class="ctrl-sel" id="reciterSel" onchange="updateDeskAudio()">
              <option value="ar.alafasy">Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</option>
              <option value="ar.abdulbasitmurattal">Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø· (Ù…Ø±ØªÙ„)</option>
              <option value="ar.husary">Ù…Ø­Ù…ÙˆØ¯ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø­ØµØ±ÙŠ</option>
              <option value="ar.minshawi">Ù…Ø­Ù…Ø¯ ØµØ¯ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ</option>
              <option value="ar.abdullahbasfar">Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨ØµÙØ±</option>
              <option value="ar.saoodshuraym">Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠÙ…</option>
            </select>
          </div>
          <div class="ctrl-g"><span class="ctrl-lbl">Ø§Ù„Ø®Ø·:</span>
            <div class="font-btns"><button class="font-btn" onclick="changeFont(-1)">âˆ’</button><button class="font-btn" onclick="changeFont(1)">+</button></div>
          </div>
          <button class="save-btn" id="saveBtn" onclick="toggleSave()">ğŸ’¾ Ø­ÙØ¸ Ø¨Ø¯ÙˆÙ† Ù†Øª</button>
        </div>
        <div class="audio-wrap">
          <span class="audio-lbl">ğŸ™ï¸</span>
          <audio id="deskPlayer" controls></audio>
          <a class="dl-btn" id="deskDl" href="#" download>ğŸ“¥ MP3</a>
        </div>
        <div class="tabs">
          <button class="tab-btn active" onclick="switchTab('quran',this)">ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù†</button>
          <button class="tab-btn" onclick="switchTab('tafseer',this)">ğŸ’¡ Ø§Ù„ØªÙØ³ÙŠØ±</button>
        </div>
        <div class="quran-text" id="quranText"></div>
        <div class="tafseer-text" id="tafseerText"></div>
      </div>

      <div class="saved-wrap" id="savedWrap"><div class="saved-head">ğŸ“š Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</div><div class="saved-pills" id="savedPills"></div></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• MOBILE FLIP READER â•â•â•â•â•â•â•â• -->
<div id="mobileReader">

  <!-- Mobile topbar -->
  <div class="mob-topbar">
    <a href="index.html" class="mob-back">â¬… Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <span class="mob-title" id="mobTitle">Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>
    <div class="mob-acts">
      <button class="mob-btn" onclick="toggleTheme()">ğŸŒ“</button>
      <button class="mob-btn" onclick="openMobSurahMenu()">â˜°</button>
    </div>
  </div>

  <!-- Surah picker -->
  <div class="mob-surah-picker">
    <select id="mobFlipSel" onchange="selectSurah(this.value)"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©...</option></select>
  </div>

  <!-- Flip area -->
  <div class="flip-wrap" id="flipWrap">
    <!-- loader -->
    <div class="mob-loader" id="mobLoader">
      <div class="spinner"></div>
      <span class="loader-txt" id="mobLoaderTxt">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
    </div>
    <!-- empty -->
    <div class="flip-page" id="flipEmpty" style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;text-align:center;">
      <div style="font-size:3rem">ğŸ“–</div>
      <div style="font-family:'Amiri',serif;font-size:1.5rem;color:var(--tx2);">Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>
      <div style="font-size:.85rem;color:var(--tx3);">Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¹Ù„Ø§Ù‡</div>
    </div>
    <!-- page content -->
    <div class="flip-page" id="flipPage" style="display:none;"></div>
    <!-- EOS popup -->
    <div class="eos-popup" id="eosPopup">
      <div class="eos-card">
        <div class="eos-icon">âœ¨</div>
        <div class="eos-title">Ø£Ø­Ø³Ù†Øª!</div>
        <div class="eos-sub" id="eosSub">Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©<br>Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªÙØ¹Ù„ØŸ</div>
        <div class="eos-btns">
          <button class="eos-btn-main" id="eosNextBtn" onclick="goNextSurah()">ğŸ“– Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
          <button class="eos-btn-sec" onclick="openMobSurahMenu()">â˜° Ø§Ø®ØªØ± Ø³ÙˆØ±Ø©</button>
          <button class="eos-btn-dismiss" onclick="closeEos()">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Font size control -->
  <div class="fp-font-ctrl">
    <button onclick="changeMobFont(-1)">âˆ’</button>
    <span style="font-size:.7rem;color:var(--tx3);align-self:center;">Ø§Ù„Ø®Ø·</span>
    <button onclick="changeMobFont(1)">+</button>
  </div>

  <!-- Bottom nav -->
  <div class="mob-nav-bar">
    <button class="mnb-btn" id="mobPrevBtn" onclick="mobGoPage(-1)" disabled>â¯ <span id="mobPrevLbl">â€”</span></button>
    <div class="mnb-center"><strong id="mobPageLbl">â€”</strong>Ø§Ø³Ø­Ø¨ Ù„Ù„ØªÙ‚Ù„ÙŠØ¨</div>
    <button class="mnb-btn" id="mobNextBtn" onclick="mobGoPage(1)" disabled><span id="mobNextLbl">â€”</span> â®</button>
  </div>

</div><!-- /mobileReader -->

<!-- Mobile surah menu overlay -->
<div class="overlay" id="mobSurahOverlay" onclick="closeMobSurahMenu()" style="z-index:600;display:none;"></div>
<aside class="sidebar" id="mobSidebarMenu" style="z-index:700;position:fixed;top:0;right:0;bottom:0;transform:translateX(110%);transition:transform .35s;">
  <div class="sb-head">
    <a href="index.html" class="sb-logo"><div class="sb-mark">ğŸŒ™</div><span class="sb-txt">Ø§Ù„Ù…ÙˆØ³ÙˆØ¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</span></a>
    <div class="sb-search"><input type="text" placeholder="Ø§Ø¨Ø­Ø«..." id="mobSearchInput" oninput="filterMobSurahs()"><span class="sb-si">ğŸ”</span></div>
  </div>
  <div class="surah-list" id="mobSurahList"></div>
</aside>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SURAH META DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SM=[
  {n:1,name:'Ø§Ù„ÙØ§ØªØ­Ø©',nameEn:'Al-Fatihah',rev:'Ù…ÙƒÙŠØ©',ayahs:7},
  {n:2,name:'Ø§Ù„Ø¨Ù‚Ø±Ø©',nameEn:'Al-Baqarah',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:286},
  {n:3,name:'Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†',nameEn:"Ali 'Imran",rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:200},
  {n:4,name:'Ø§Ù„Ù†Ø³Ø§Ø¡',nameEn:'An-Nisa',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:176},
  {n:5,name:'Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©',nameEn:"Al-Ma'idah",rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:120},
  {n:6,name:'Ø§Ù„Ø£Ù†Ø¹Ø§Ù…',nameEn:"Al-An'am",rev:'Ù…ÙƒÙŠØ©',ayahs:165},
  {n:7,name:'Ø§Ù„Ø£Ø¹Ø±Ø§Ù',nameEn:"Al-A'raf",rev:'Ù…ÙƒÙŠØ©',ayahs:206},
  {n:8,name:'Ø§Ù„Ø£Ù†ÙØ§Ù„',nameEn:'Al-Anfal',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:75},
  {n:9,name:'Ø§Ù„ØªÙˆØ¨Ø©',nameEn:'At-Tawbah',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:129},
  {n:10,name:'ÙŠÙˆÙ†Ø³',nameEn:'Yunus',rev:'Ù…ÙƒÙŠØ©',ayahs:109},
  {n:11,name:'Ù‡ÙˆØ¯',nameEn:'Hud',rev:'Ù…ÙƒÙŠØ©',ayahs:123},
  {n:12,name:'ÙŠÙˆØ³Ù',nameEn:'Yusuf',rev:'Ù…ÙƒÙŠØ©',ayahs:111},
  {n:13,name:'Ø§Ù„Ø±Ø¹Ø¯',nameEn:"Ar-Ra'd",rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:43},
  {n:14,name:'Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…',nameEn:'Ibrahim',rev:'Ù…ÙƒÙŠØ©',ayahs:52},
  {n:15,name:'Ø§Ù„Ø­Ø¬Ø±',nameEn:'Al-Hijr',rev:'Ù…ÙƒÙŠØ©',ayahs:99},
  {n:16,name:'Ø§Ù„Ù†Ø­Ù„',nameEn:'An-Nahl',rev:'Ù…ÙƒÙŠØ©',ayahs:128},
  {n:17,name:'Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡',nameEn:'Al-Isra',rev:'Ù…ÙƒÙŠØ©',ayahs:111},
  {n:18,name:'Ø§Ù„ÙƒÙ‡Ù',nameEn:'Al-Kahf',rev:'Ù…ÙƒÙŠØ©',ayahs:110},
  {n:19,name:'Ù…Ø±ÙŠÙ…',nameEn:'Maryam',rev:'Ù…ÙƒÙŠØ©',ayahs:98},
  {n:20,name:'Ø·Ù‡',nameEn:'Ta-Ha',rev:'Ù…ÙƒÙŠØ©',ayahs:135},
  {n:21,name:'Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡',nameEn:'Al-Anbiya',rev:'Ù…ÙƒÙŠØ©',ayahs:112},
  {n:22,name:'Ø§Ù„Ø­Ø¬',nameEn:'Al-Hajj',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:78},
  {n:23,name:'Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†',nameEn:"Al-Mu'minun",rev:'Ù…ÙƒÙŠØ©',ayahs:118},
  {n:24,name:'Ø§Ù„Ù†ÙˆØ±',nameEn:'An-Nur',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:64},
  {n:25,name:'Ø§Ù„ÙØ±Ù‚Ø§Ù†',nameEn:'Al-Furqan',rev:'Ù…ÙƒÙŠØ©',ayahs:77},
  {n:26,name:'Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡',nameEn:"Ash-Shu'ara",rev:'Ù…ÙƒÙŠØ©',ayahs:227},
  {n:27,name:'Ø§Ù„Ù†Ù…Ù„',nameEn:'An-Naml',rev:'Ù…ÙƒÙŠØ©',ayahs:93},
  {n:28,name:'Ø§Ù„Ù‚ØµØµ',nameEn:'Al-Qasas',rev:'Ù…ÙƒÙŠØ©',ayahs:88},
  {n:29,name:'Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª',nameEn:"Al-'Ankabut",rev:'Ù…ÙƒÙŠØ©',ayahs:69},
  {n:30,name:'Ø§Ù„Ø±ÙˆÙ…',nameEn:'Ar-Rum',rev:'Ù…ÙƒÙŠØ©',ayahs:60},
  {n:31,name:'Ù„Ù‚Ù…Ø§Ù†',nameEn:'Luqman',rev:'Ù…ÙƒÙŠØ©',ayahs:34},
  {n:32,name:'Ø§Ù„Ø³Ø¬Ø¯Ø©',nameEn:'As-Sajdah',rev:'Ù…ÙƒÙŠØ©',ayahs:30},
  {n:33,name:'Ø§Ù„Ø£Ø­Ø²Ø§Ø¨',nameEn:'Al-Ahzab',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:73},
  {n:34,name:'Ø³Ø¨Ø£',nameEn:'Saba',rev:'Ù…ÙƒÙŠØ©',ayahs:54},
  {n:35,name:'ÙØ§Ø·Ø±',nameEn:'Fatir',rev:'Ù…ÙƒÙŠØ©',ayahs:45},
  {n:36,name:'ÙŠØ³',nameEn:'Ya-Sin',rev:'Ù…ÙƒÙŠØ©',ayahs:83},
  {n:37,name:'Ø§Ù„ØµØ§ÙØ§Øª',nameEn:'As-Saffat',rev:'Ù…ÙƒÙŠØ©',ayahs:182},
  {n:38,name:'Øµ',nameEn:'Sad',rev:'Ù…ÙƒÙŠØ©',ayahs:88},
  {n:39,name:'Ø§Ù„Ø²Ù…Ø±',nameEn:'Az-Zumar',rev:'Ù…ÙƒÙŠØ©',ayahs:75},
  {n:40,name:'ØºØ§ÙØ±',nameEn:'Ghafir',rev:'Ù…ÙƒÙŠØ©',ayahs:85},
  {n:41,name:'ÙØµÙ„Øª',nameEn:'Fussilat',rev:'Ù…ÙƒÙŠØ©',ayahs:54},
  {n:42,name:'Ø§Ù„Ø´ÙˆØ±Ù‰',nameEn:'Ash-Shura',rev:'Ù…ÙƒÙŠØ©',ayahs:53},
  {n:43,name:'Ø§Ù„Ø²Ø®Ø±Ù',nameEn:'Az-Zukhruf',rev:'Ù…ÙƒÙŠØ©',ayahs:89},
  {n:44,name:'Ø§Ù„Ø¯Ø®Ø§Ù†',nameEn:'Ad-Dukhan',rev:'Ù…ÙƒÙŠØ©',ayahs:59},
  {n:45,name:'Ø§Ù„Ø¬Ø§Ø«ÙŠØ©',nameEn:'Al-Jathiyah',rev:'Ù…ÙƒÙŠØ©',ayahs:37},
  {n:46,name:'Ø§Ù„Ø£Ø­Ù‚Ø§Ù',nameEn:'Al-Ahqaf',rev:'Ù…ÙƒÙŠØ©',ayahs:35},
  {n:47,name:'Ù…Ø­Ù…Ø¯',nameEn:'Muhammad',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:38},
  {n:48,name:'Ø§Ù„ÙØªØ­',nameEn:'Al-Fath',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:29},
  {n:49,name:'Ø§Ù„Ø­Ø¬Ø±Ø§Øª',nameEn:'Al-Hujurat',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:18},
  {n:50,name:'Ù‚',nameEn:'Qaf',rev:'Ù…ÙƒÙŠØ©',ayahs:45},
  {n:51,name:'Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª',nameEn:'Adh-Dhariyat',rev:'Ù…ÙƒÙŠØ©',ayahs:60},
  {n:52,name:'Ø§Ù„Ø·ÙˆØ±',nameEn:'At-Tur',rev:'Ù…ÙƒÙŠØ©',ayahs:49},
  {n:53,name:'Ø§Ù„Ù†Ø¬Ù…',nameEn:'An-Najm',rev:'Ù…ÙƒÙŠØ©',ayahs:62},
  {n:54,name:'Ø§Ù„Ù‚Ù…Ø±',nameEn:'Al-Qamar',rev:'Ù…ÙƒÙŠØ©',ayahs:55},
  {n:55,name:'Ø§Ù„Ø±Ø­Ù…Ù†',nameEn:'Ar-Rahman',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:78},
  {n:56,name:'Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©',nameEn:"Al-Waqi'ah",rev:'Ù…ÙƒÙŠØ©',ayahs:96},
  {n:57,name:'Ø§Ù„Ø­Ø¯ÙŠØ¯',nameEn:'Al-Hadid',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:29},
  {n:58,name:'Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©',nameEn:'Al-Mujadila',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:22},
  {n:59,name:'Ø§Ù„Ø­Ø´Ø±',nameEn:'Al-Hashr',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:24},
  {n:60,name:'Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©',nameEn:'Al-Mumtahanah',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:13},
  {n:61,name:'Ø§Ù„ØµÙ',nameEn:'As-Saf',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:14},
  {n:62,name:'Ø§Ù„Ø¬Ù…Ø¹Ø©',nameEn:"Al-Jumu'ah",rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:11},
  {n:63,name:'Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†',nameEn:'Al-Munafiqun',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:11},
  {n:64,name:'Ø§Ù„ØªØºØ§Ø¨Ù†',nameEn:'At-Taghabun',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:18},
  {n:65,name:'Ø§Ù„Ø·Ù„Ø§Ù‚',nameEn:'At-Talaq',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:12},
  {n:66,name:'Ø§Ù„ØªØ­Ø±ÙŠÙ…',nameEn:'At-Tahrim',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:12},
  {n:67,name:'Ø§Ù„Ù…Ù„Ùƒ',nameEn:'Al-Mulk',rev:'Ù…ÙƒÙŠØ©',ayahs:30},
  {n:68,name:'Ø§Ù„Ù‚Ù„Ù…',nameEn:'Al-Qalam',rev:'Ù…ÙƒÙŠØ©',ayahs:52},
  {n:69,name:'Ø§Ù„Ø­Ø§Ù‚Ø©',nameEn:'Al-Haqqah',rev:'Ù…ÙƒÙŠØ©',ayahs:52},
  {n:70,name:'Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬',nameEn:"Al-Ma'arij",rev:'Ù…ÙƒÙŠØ©',ayahs:44},
  {n:71,name:'Ù†ÙˆØ­',nameEn:'Nuh',rev:'Ù…ÙƒÙŠØ©',ayahs:28},
  {n:72,name:'Ø§Ù„Ø¬Ù†',nameEn:'Al-Jinn',rev:'Ù…ÙƒÙŠØ©',ayahs:28},
  {n:73,name:'Ø§Ù„Ù…Ø²Ù…Ù„',nameEn:'Al-Muzzammil',rev:'Ù…ÙƒÙŠØ©',ayahs:20},
  {n:74,name:'Ø§Ù„Ù…Ø¯Ø«Ø±',nameEn:'Al-Muddaththir',rev:'Ù…ÙƒÙŠØ©',ayahs:56},
  {n:75,name:'Ø§Ù„Ù‚ÙŠØ§Ù…Ø©',nameEn:'Al-Qiyamah',rev:'Ù…ÙƒÙŠØ©',ayahs:40},
  {n:76,name:'Ø§Ù„Ø¥Ù†Ø³Ø§Ù†',nameEn:'Al-Insan',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:31},
  {n:77,name:'Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª',nameEn:'Al-Mursalat',rev:'Ù…ÙƒÙŠØ©',ayahs:50},
  {n:78,name:'Ø§Ù„Ù†Ø¨Ø£',nameEn:'An-Naba',rev:'Ù…ÙƒÙŠØ©',ayahs:40},
  {n:79,name:'Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª',nameEn:"An-Nazi'at",rev:'Ù…ÙƒÙŠØ©',ayahs:46},
  {n:80,name:'Ø¹Ø¨Ø³',nameEn:"'Abasa",rev:'Ù…ÙƒÙŠØ©',ayahs:42},
  {n:81,name:'Ø§Ù„ØªÙƒÙˆÙŠØ±',nameEn:'At-Takwir',rev:'Ù…ÙƒÙŠØ©',ayahs:29},
  {n:82,name:'Ø§Ù„Ø¥Ù†ÙØ·Ø§Ø±',nameEn:'Al-Infitar',rev:'Ù…ÙƒÙŠØ©',ayahs:19},
  {n:83,name:'Ø§Ù„Ù…Ø·ÙÙÙŠÙ†',nameEn:'Al-Mutaffifin',rev:'Ù…ÙƒÙŠØ©',ayahs:36},
  {n:84,name:'Ø§Ù„Ø¥Ù†Ø´Ù‚Ø§Ù‚',nameEn:'Al-Inshiqaq',rev:'Ù…ÙƒÙŠØ©',ayahs:25},
  {n:85,name:'Ø§Ù„Ø¨Ø±ÙˆØ¬',nameEn:'Al-Buruj',rev:'Ù…ÙƒÙŠØ©',ayahs:22},
  {n:86,name:'Ø§Ù„Ø·Ø§Ø±Ù‚',nameEn:'At-Tariq',rev:'Ù…ÙƒÙŠØ©',ayahs:17},
  {n:87,name:'Ø§Ù„Ø£Ø¹Ù„Ù‰',nameEn:"Al-A'la",rev:'Ù…ÙƒÙŠØ©',ayahs:19},
  {n:88,name:'Ø§Ù„ØºØ§Ø´ÙŠØ©',nameEn:'Al-Ghashiyah',rev:'Ù…ÙƒÙŠØ©',ayahs:26},
  {n:89,name:'Ø§Ù„ÙØ¬Ø±',nameEn:'Al-Fajr',rev:'Ù…ÙƒÙŠØ©',ayahs:30},
  {n:90,name:'Ø§Ù„Ø¨Ù„Ø¯',nameEn:'Al-Balad',rev:'Ù…ÙƒÙŠØ©',ayahs:20},
  {n:91,name:'Ø§Ù„Ø´Ù…Ø³',nameEn:'Ash-Shams',rev:'Ù…ÙƒÙŠØ©',ayahs:15},
  {n:92,name:'Ø§Ù„Ù„ÙŠÙ„',nameEn:'Al-Layl',rev:'Ù…ÙƒÙŠØ©',ayahs:21},
  {n:93,name:'Ø§Ù„Ø¶Ø­Ù‰',nameEn:'Ad-Duhaa',rev:'Ù…ÙƒÙŠØ©',ayahs:11},
  {n:94,name:'Ø§Ù„Ø´Ø±Ø­',nameEn:'Ash-Sharh',rev:'Ù…ÙƒÙŠØ©',ayahs:8},
  {n:95,name:'Ø§Ù„ØªÙŠÙ†',nameEn:'At-Tin',rev:'Ù…ÙƒÙŠØ©',ayahs:8},
  {n:96,name:'Ø§Ù„Ø¹Ù„Ù‚',nameEn:"Al-'Alaq",rev:'Ù…ÙƒÙŠØ©',ayahs:19},
  {n:97,name:'Ø§Ù„Ù‚Ø¯Ø±',nameEn:'Al-Qadr',rev:'Ù…ÙƒÙŠØ©',ayahs:5},
  {n:98,name:'Ø§Ù„Ø¨ÙŠÙ†Ø©',nameEn:'Al-Bayyinah',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:8},
  {n:99,name:'Ø§Ù„Ø²Ù„Ø²Ù„Ø©',nameEn:'Az-Zalzalah',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:8},
  {n:100,name:'Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª',nameEn:"Al-'Adiyat",rev:'Ù…ÙƒÙŠØ©',ayahs:11},
  {n:101,name:'Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©',nameEn:"Al-Qari'ah",rev:'Ù…ÙƒÙŠØ©',ayahs:11},
  {n:102,name:'Ø§Ù„ØªÙƒØ§Ø«Ø±',nameEn:'At-Takathur',rev:'Ù…ÙƒÙŠØ©',ayahs:8},
  {n:103,name:'Ø§Ù„Ø¹ØµØ±',nameEn:"Al-'Asr",rev:'Ù…ÙƒÙŠØ©',ayahs:3},
  {n:104,name:'Ø§Ù„Ù‡Ù…Ø²Ø©',nameEn:'Al-Humazah',rev:'Ù…ÙƒÙŠØ©',ayahs:9},
  {n:105,name:'Ø§Ù„ÙÙŠÙ„',nameEn:'Al-Fil',rev:'Ù…ÙƒÙŠØ©',ayahs:5},
  {n:106,name:'Ù‚Ø±ÙŠØ´',nameEn:'Quraysh',rev:'Ù…ÙƒÙŠØ©',ayahs:4},
  {n:107,name:'Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†',nameEn:"Al-Ma'un",rev:'Ù…ÙƒÙŠØ©',ayahs:7},
  {n:108,name:'Ø§Ù„ÙƒÙˆØ«Ø±',nameEn:'Al-Kawthar',rev:'Ù…ÙƒÙŠØ©',ayahs:3},
  {n:109,name:'Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†',nameEn:'Al-Kafirun',rev:'Ù…ÙƒÙŠØ©',ayahs:6},
  {n:110,name:'Ø§Ù„Ù†ØµØ±',nameEn:'An-Nasr',rev:'Ù…Ø¯Ù†ÙŠØ©',ayahs:3},
  {n:111,name:'Ø§Ù„Ù…Ø³Ø¯',nameEn:'Al-Masad',rev:'Ù…ÙƒÙŠØ©',ayahs:5},
  {n:112,name:'Ø§Ù„Ø¥Ø®Ù„Ø§Øµ',nameEn:'Al-Ikhlas',rev:'Ù…ÙƒÙŠØ©',ayahs:4},
  {n:113,name:'Ø§Ù„ÙÙ„Ù‚',nameEn:'Al-Falaq',rev:'Ù…ÙƒÙŠØ©',ayahs:5},
  {n:114,name:'Ø§Ù„Ù†Ø§Ø³',nameEn:'An-Nas',rev:'Ù…ÙƒÙŠØ©',ayahs:6}
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentSurah = null;   // current surah number
let currentTab   = 'quran';
let deskFontSize = 1.95;
let mobFontSize  = 1.75;
let savedSurahs  = [];
let surahCache   = {};     // {n: {ayahs:[],tafseer:[]}}

/* pages for mobile flip */
let mobPages     = [];     // array of page HTML strings
let mobPageIdx   = 0;      // current page index (0-based)
let isMobLoading = false;
const AYAHS_PER_PAGE = 10; // ~10 Ø¢ÙŠØ§Øª Ù„ÙƒÙ„ ØµÙØ­Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„

function toAr(n){return String(n).replace(/\d/g,d=>'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'[d]);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR BUILD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildList(listEl, data, onSelect){
  listEl.innerHTML = data.map(s=>`
    <div class="si ${currentSurah==s.n?'active':''}" id="${listEl.id}-${s.n}" onclick="${onSelect}(${s.n})">
      <div class="si-num">${toAr(s.n)}</div>
      <div class="si-inf"><span class="si-name">${s.name}</span><span class="si-meta">${s.nameEn} Â· ${toAr(s.ayahs)} Ø¢ÙŠØ©</span></div>
      <span class="si-rev">${s.rev}</span>
    </div>`).join('');
}

function buildSidebars(){
  buildList(document.getElementById('surahList'), SM, 'selectSurah');
  buildList(document.getElementById('mobSurahList'), SM, 'selectSurah');
  // populate selects
  ['mobSurahSel','mobFlipSel'].forEach(id=>{
    const sel = document.getElementById(id);
    SM.forEach(s=>{const o=document.createElement('option');o.value=s.n;o.textContent=`${toAr(s.n)}. ${s.name}`;sel.appendChild(o);});
  });
}

function filterSurahs(){
  const q = document.getElementById('searchInput').value.trim().toLowerCase();
  buildList(document.getElementById('surahList'), q ? SM.filter(s=>s.name.includes(q)||s.nameEn.toLowerCase().includes(q)||String(s.n).includes(q)) : SM, 'selectSurah');
}
function filterMobSurahs(){
  const q = document.getElementById('mobSearchInput').value.trim().toLowerCase();
  buildList(document.getElementById('mobSurahList'), q ? SM.filter(s=>s.name.includes(q)||s.nameEn.toLowerCase().includes(q)||String(s.n).includes(q)) : SM, 'selectSurah');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SELECT SURAH (unified)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function selectSurah(n){
  if(!n) return;
  n = parseInt(n);
  currentSurah = n;
  localStorage.setItem('qLastSurah', n);

  // sync selects
  document.getElementById('mobSurahSel').value  = n;
  document.getElementById('mobFlipSel').value   = n;

  // highlight sidebars
  document.querySelectorAll('.si').forEach(el=>el.classList.remove('active'));
  ['surahList','mobSurahList'].forEach(id=>{
    const el = document.getElementById(`${id}-${n}`);
    if(el){el.classList.add('active');el.scrollIntoView({block:'nearest'});}
  });

  closeSidebar();
  closeMobSurahMenu();

  const isMobile = window.innerWidth <= 860;
  if(isMobile) await loadMobile(n);
  else         await loadDesktop(n);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FETCH DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function fetchSurah(n){
  if(surahCache[n]) return surahCache[n];
  if(!navigator.onLine){
    const sv = savedSurahs.find(s=>s.n==n);
    if(sv) return sv;
    return null;
  }
  try{
    const [qRes, tRes] = await Promise.all([
      fetch(`https://api.alquran.cloud/v1/surah/${n}/quran-uthmani`),
      fetch(`https://api.alquran.cloud/v1/surah/${n}/ar.muyassar`)
    ]);
    const qData = (await qRes.json()).data;
    const tData = (await tRes.json()).data;
    const result = { n, name: qData.name, ayahs: qData.ayahs, tafseer: tData.ayahs };
    surahCache[n] = result;
    return result;
  }catch(e){ return null; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESKTOP LOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadDesktop(n){
  showDeskLoader('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø©...');
  const data = await fetchSurah(n);
  if(!data){ hideDeskLoader(); showToast('âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„'); return; }

  const meta = SM.find(s=>s.n==n)||{};
  document.getElementById('shNum').textContent      = toAr(n);
  document.getElementById('shName').textContent     = `Ø³ÙˆØ±Ø© ${data.name}`;
  document.getElementById('shNameEn').textContent   = meta.nameEn||'';
  document.getElementById('shRev').textContent      = meta.rev||'';
  document.getElementById('shAyahs').textContent    = toAr(meta.ayahs||data.ayahs.length);
  document.getElementById('topbarTitle').textContent= `Ø³ÙˆØ±Ø© ${data.name}`;
  document.getElementById('deskBism').style.display = n==9?'none':'block';

  document.getElementById('quranText').innerHTML =
    data.ayahs.map(a=>`<span class="ayah-span">${a.text}<span class="ayah-num">${toAr(a.numberInSurah)}</span></span> `).join('');

  if(data.tafseer){
    document.getElementById('tafseerText').innerHTML =
      data.tafseer.map((a,i)=>`<div class="ta"><div class="ta-ar"><span class="ta-n">${toAr(a.numberInSurah)}</span>${data.ayahs[i]?.text||''}</div><div class="ta-tf">${a.text}</div></div>`).join('');
  }

  updateDeskAudio();
  updateSaveBtn();
  switchTab(currentTab, null, true);

  hideDeskLoader();
  document.getElementById('emptyState').style.display = 'none';
  document.getElementById('surahCard').classList.add('show');
  window.scrollTo({top:0,behavior:'smooth'});
}

function updateDeskAudio(){
  if(!currentSurah) return;
  const rec = document.getElementById('reciterSel').value;
  const url = `https://cdn.islamic.network/quran/audio-surah/128/${rec}/${currentSurah}.mp3`;
  document.getElementById('deskPlayer').src = url;
  document.getElementById('deskDl').href   = url;
}

function showDeskLoader(msg){
  document.getElementById('surahCard').classList.remove('show');
  document.getElementById('emptyState').style.display = 'none';
  document.getElementById('loaderTxt').textContent = msg;
  document.getElementById('loader').classList.add('show');
}
function hideDeskLoader(){ document.getElementById('loader').classList.remove('show'); }

function switchTab(tab, btn, silent){
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
  else document.querySelectorAll('.tab-btn')[tab==='quran'?0:1]?.classList.add('active');
  document.getElementById('quranText').style.display = tab==='quran'?'block':'none';
  document.getElementById('tafseerText').classList.toggle('show', tab==='tafseer');
}

function changeFont(d){
  deskFontSize = Math.max(1.4, Math.min(3.5, deskFontSize + d*0.15));
  document.getElementById('quranText').style.fontSize = deskFontSize + 'rem';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOBILE FLIP LOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadMobile(n){
  if(isMobLoading) return;
  isMobLoading = true;
  closeEos();
  showMobLoader('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø©...');
  document.getElementById('flipEmpty').style.display = 'none';

  const data = await fetchSurah(n);
  if(!data){ hideMobLoader(); showToast('âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„'); isMobLoading=false; return; }

  const meta = SM.find(s=>s.n==n)||{};
  document.getElementById('mobTitle').textContent = `Ø³ÙˆØ±Ø© ${data.name}`;

  // Build pages: split ayahs into chunks
  mobPages   = buildMobPages(data, meta);
  mobPageIdx = 0;

  renderMobPage(0, 0);
  hideMobLoader();
  updateMobNav();
  isMobLoading = false;
}

function buildMobPages(data, meta){
  const ayahs = data.ayahs;
  const pages = [];
  let i = 0;

  // First page always has the header + audio + first chunk
  const FIRST_CHUNK = 6;
  const REST_CHUNK  = AYAHS_PER_PAGE;

  while(i < ayahs.length){
    const chunkSize = pages.length === 0 ? FIRST_CHUNK : REST_CHUNK;
    const chunk = ayahs.slice(i, i + chunkSize);
    const isFirst = pages.length === 0;
    const isLast  = (i + chunkSize) >= ayahs.length;

    let html = '';

    if(isFirst){
      // Header
      html += `<div class="fp-header">
        <div class="fp-surah-name">Ø³ÙˆØ±Ø© ${data.name}</div>
        <div class="fp-meta">${meta.rev||''} Â· ${toAr(meta.ayahs||ayahs.length)} Ø¢ÙŠØ© Â· ${meta.nameEn||''}</div>
        ${meta.n !== 9 ? `<div class="fp-bism">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ€Ù°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>` : ''}
      </div>
      <div class="fp-audio">
        <span class="fp-audio-lbl">ğŸ™ï¸</span>
        <audio id="mobPlayer" controls></audio>
        <select class="fp-reciter" id="mobReciterSel" onchange="updateMobAudio()">
          <option value="ar.alafasy">Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</option>
          <option value="ar.abdulbasitmurattal">Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø·</option>
          <option value="ar.husary">Ø§Ù„Ø­ØµØ±ÙŠ</option>
          <option value="ar.minshawi">Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ</option>
          <option value="ar.abdullahbasfar">Ø¨ØµÙØ±</option>
          <option value="ar.saoodshuraym">Ø§Ù„Ø´Ø±ÙŠÙ…</option>
        </select>
      </div>`;
      // set audio after render
      setTimeout(updateMobAudio, 100);
    }

    html += `<div class="fp-text" id="fp-text-${pages.length}">` +
      chunk.map(a=>`<span class="ayah-span">${a.text}<span class="ayah-num">${toAr(a.numberInSurah)}</span></span> `).join('') +
    `</div>`;

    pages.push({ html, isFirst, isLast, firstAyah: chunk[0]?.numberInSurah, lastAyah: chunk[chunk.length-1]?.numberInSurah });
    i += chunkSize;
  }
  return pages;
}

function renderMobPage(idx, dir){
  if(idx < 0 || idx >= mobPages.length) return;
  const fp = document.getElementById('flipPage');
  fp.style.display = 'block';

  // animate
  fp.className = 'flip-page';
  void fp.offsetWidth;
  if(dir > 0) fp.classList.add('slide-in-left');
  else if(dir < 0) fp.classList.add('slide-in-right');

  fp.innerHTML = mobPages[idx].html;
  fp.scrollTop = 0;
  mobPageIdx = idx;

  // re-apply font size
  const texts = fp.querySelectorAll('.fp-text');
  texts.forEach(t => t.style.fontSize = mobFontSize + 'rem');

  // if first page, re-bind audio
  if(mobPages[idx].isFirst) setTimeout(updateMobAudio, 50);

  updateMobNav();

  // Show EOS popup at last page
  if(mobPages[idx].isLast && dir > 0){
    setTimeout(showEos, 600);
  }
}

function mobGoPage(dir){
  const next = mobPageIdx + dir;
  if(next < 0 || next >= mobPages.length) return;
  renderMobPage(next, dir);
}

function updateMobNav(){
  const p = mobPageIdx;
  const total = mobPages.length;
  document.getElementById('mobPrevBtn').disabled = p <= 0;
  document.getElementById('mobNextBtn').disabled = p >= total-1;
  document.getElementById('mobPrevLbl').textContent = p > 0      ? `Øµ ${toAr(p)}`       : 'â€”';
  document.getElementById('mobNextLbl').textContent = p < total-1 ? `Øµ ${toAr(p+2)}` : 'â€”';
  document.getElementById('mobPageLbl').textContent = total > 0 ? `${toAr(p+1)} / ${toAr(total)}` : 'â€”';
}

function updateMobAudio(){
  if(!currentSurah) return;
  const sel = document.getElementById('mobReciterSel');
  if(!sel) return;
  const rec = sel.value;
  const url = `https://cdn.islamic.network/quran/audio-surah/128/${rec}/${currentSurah}.mp3`;
  const pl  = document.getElementById('mobPlayer');
  if(pl) pl.src = url;
}

function changeMobFont(d){
  mobFontSize = Math.max(1.2, Math.min(3.2, mobFontSize + d*0.15));
  document.querySelectorAll('.fp-text').forEach(t=>t.style.fontSize=mobFontSize+'rem');
}

function showMobLoader(msg){
  document.getElementById('mobLoaderTxt').textContent = msg;
  document.getElementById('mobLoader').classList.add('show');
}
function hideMobLoader(){ document.getElementById('mobLoader').classList.remove('show'); }

/* â”€â”€ EOS (End of Surah) popup â”€â”€ */
function showEos(){
  const meta = SM.find(s=>s.n==currentSurah);
  const nextMeta = SM.find(s=>s.n==(currentSurah+1));
  document.getElementById('eosSub').innerHTML =
    `Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø³ÙˆØ±Ø© ${meta?.name||''}<br>` +
    (nextMeta ? `Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: <strong style="color:var(--gold-l)">${nextMeta.name}</strong>` : 'Ù‡Ø°Ù‡ Ø¢Ø®Ø± Ø³ÙˆØ±Ø©');
  document.getElementById('eosNextBtn').style.display = nextMeta ? 'block' : 'none';
  document.getElementById('eosPopup').classList.add('show');
}
function closeEos(){ document.getElementById('eosPopup').classList.remove('show'); }
function goNextSurah(){
  closeEos();
  if(currentSurah < 114) selectSurah(currentSurah + 1);
}

/* â”€â”€ Touch swipe â”€â”€ */
(function(){
  let sx=0, sy=0, sTime=0;
  const fw = document.getElementById('flipWrap');
  if(!fw) return;

  fw.addEventListener('touchstart', e=>{
    sx=e.touches[0].clientX; sy=e.touches[0].clientY; sTime=Date.now();
  },{passive:true});

  fw.addEventListener('touchend', e=>{
    if(mobPages.length===0) return;
    const dx = e.changedTouches[0].clientX - sx;
    const dy = e.changedTouches[0].clientY - sy;
    const dt = Date.now() - sTime;
    // only horizontal, fast enough, and long enough
    if(Math.abs(dy) > Math.abs(dx)*0.8) return;
    if(Math.abs(dx) < 45) return;
    if(dt > 600) return;
    // RTL: swipe right (dx>0) = next page, swipe left (dx<0) = prev page
    mobGoPage(dx > 0 ? 1 : -1);
  },{passive:true});
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE / OFFLINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleSave(){
  if(!currentSurah) return;
  const idx = savedSurahs.findIndex(s=>s.n==currentSurah);
  if(idx>-1){ savedSurahs.splice(idx,1); showToast('ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø¥Ø²Ø§Ù„Ø©'); }
  else {
    const d = surahCache[currentSurah];
    if(d) savedSurahs.push(d);
    showToast('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø¯ÙˆÙ† Ù†Øª');
  }
  localStorage.setItem('savedSurahs', JSON.stringify(savedSurahs));
  updateSaveBtn(); renderSavedPills();
}
function updateSaveBtn(){
  const saved = savedSurahs.some(s=>s.n==currentSurah);
  const btn = document.getElementById('saveBtn');
  if(!btn) return;
  btn.textContent = saved ? 'âœ“ Ù…Ø­ÙÙˆØ¸Ø©' : 'ğŸ’¾ Ø­ÙØ¸ Ø¨Ø¯ÙˆÙ† Ù†Øª';
  btn.classList.toggle('saved', saved);
}
function renderSavedPills(){
  const w = document.getElementById('savedWrap');
  const p = document.getElementById('savedPills');
  if(savedSurahs.length===0){w.classList.remove('show');return;}
  w.classList.add('show');
  p.innerHTML = savedSurahs.map(s=>`<div class="saved-pill" onclick="selectSurah(${s.n})">${s.name}</div>`).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleSidebar(){
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('overlay').classList.toggle('show');
  document.getElementById('burgerBtn')?.classList.toggle('open');
}
function closeSidebar(){
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('overlay').classList.remove('show');
  document.getElementById('burgerBtn')?.classList.remove('open');
}

function openMobSurahMenu(){
  document.getElementById('mobSidebarMenu').style.transform='translateX(0)';
  document.getElementById('mobSurahOverlay').style.display='block';
}
function closeMobSurahMenu(){
  document.getElementById('mobSidebarMenu').style.transform='translateX(110%)';
  document.getElementById('mobSurahOverlay').style.display='none';
}

function toggleTheme(){
  document.body.classList.toggle('light');
  localStorage.setItem('qTheme', document.body.classList.contains('light')?'light':'dark');
}

function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3000);
}

function checkOnline(){ document.getElementById('offlineBar').classList.toggle('show',!navigator.onLine); }
window.addEventListener('online',checkOnline);
window.addEventListener('offline',checkOnline);

window.addEventListener('scroll',()=>{
  document.getElementById('topbar').classList.toggle('scrolled',scrollY>20);
},{passive:true});

/* â”€â”€ On resize: reload if crossing breakpoint â”€â”€ */
let lastMobile = window.innerWidth <= 860;
window.addEventListener('resize', ()=>{
  const isMob = window.innerWidth <= 860;
  if(isMob !== lastMobile && currentSurah){
    lastMobile = isMob;
    selectSurah(currentSurah);
  }
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('DOMContentLoaded', ()=>{
  buildSidebars();
  checkOnline();
  if(localStorage.getItem('qTheme')==='light') document.body.classList.add('light');
  savedSurahs = JSON.parse(localStorage.getItem('savedSurahs')||'[]');
  // reload saved into cache
  savedSurahs.forEach(s=>{ if(s.ayahs) surahCache[s.n]=s; });
  renderSavedPills();

  const last = localStorage.getItem('qLastSurah');
  if(last) selectSurah(parseInt(last));
});

if('serviceWorker' in navigator){
  navigator.serviceWorker.register('/eslame/sw.js',{scope:'/eslame/'})
    .then(r=>console.log('[SW]',r.scope)).catch(()=>{});
}
</script>
</body>
</html>
